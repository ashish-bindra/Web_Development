
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../asynchronous_api/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>celery - Web Development Tutorials</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#celery-distributed-task-queue" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Web Development Tutorials" class="md-header__button md-logo" aria-label="Web Development Tutorials" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Web Development Tutorials
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              celery
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../database/" class="md-tabs__link">
          
  
  
    
  
  database

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Django/" class="md-tabs__link">
          
  
  
    
  
  Django

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../js/durgajs/" class="md-tabs__link">
          
  
  
    
  
  js

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  Fastapi

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tools/poetry/" class="md-tabs__link">
          
  
  
    
  
  tools

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../pydantic/" class="md-tabs__link">
        
  
  
    
  
  Pydantic

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../important/" class="md-tabs__link">
        
  
  
    
  
  imp

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../revision/" class="md-tabs__link">
        
  
  
    
  
  revision

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Web Development Tutorials" class="md-nav__button md-logo" aria-label="Web Development Tutorials" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Web Development Tutorials
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../database/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    database
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            database
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/view/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    View
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/indexes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    index
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/equi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Equi-join
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/self_join/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    self-join
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/subqueries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    sub-query
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/sql%20faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ SQL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/DA_SQL_Sorting_Grouping/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DA SQL Grouping
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/query/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    query
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/practice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    practice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/interview_pratical/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    interview praticale
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/interview_theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    interview theory
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/radis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    radis
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../Django/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Django
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Django
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Django/Django/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Django
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    js
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            js
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../js/durgajs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../js/dom/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DOM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../js/jQuery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JQuery
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Fastapi
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Fastapi
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    celery
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    celery
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#celery-vs-fastapis-backgroundtasks" class="md-nav__link">
    <span class="md-ellipsis">
      ⚖️ Celery vs FastAPI’s BackgroundTasks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="⚖️ Celery vs FastAPI’s BackgroundTasks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-should-you-use-celery-instead-of-fastapis-built-in-backgroundtasks" class="md-nav__link">
    <span class="md-ellipsis">
      When should you use Celery instead of FastAPI's built-in BackgroundTasks?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="When should you use Celery instead of FastAPI&#39;s built-in BackgroundTasks?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-cpu-intensive-or-time-consuming-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      1. CPU-Intensive or Time-Consuming Tasks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-task-management-and-status-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      2. Task Management and Status Tracking
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-notes" class="md-nav__link">
    <span class="md-ellipsis">
      🧪 Example Notes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-a-task-queue" class="md-nav__link">
    <span class="md-ellipsis">
      🔄 What is a Task Queue?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redis-in-memory-data-store" class="md-nav__link">
    <span class="md-ellipsis">
      💾 Redis — In-Memory Data Store
    </span>
  </a>
  
    <nav class="md-nav" aria-label="💾 Redis — In-Memory Data Store">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-redis-use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      ✅ Common Redis Use Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      📦 Installation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📦 Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-celery" class="md-nav__link">
    <span class="md-ellipsis">
      Install Celery
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-redis-python-client" class="md-nav__link">
    <span class="md-ellipsis">
      Install Redis (Python client)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-docker-compose-snippet-for-redis" class="md-nav__link">
    <span class="md-ellipsis">
      Example Docker Compose snippet for Redis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#in-memory-database-vs-cache" class="md-nav__link">
    <span class="md-ellipsis">
      🧠 In-Memory Database vs. Cache
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-celery" class="md-nav__link">
    <span class="md-ellipsis">
      ▶️ Running Celery
    </span>
  </a>
  
    <nav class="md-nav" aria-label="▶️ Running Celery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-python-file-interactive-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Run Python File (Interactive Mode)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-celery-worker" class="md-nav__link">
    <span class="md-ellipsis">
      Start Celery Worker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Start Celery Worker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-linuxmacos" class="md-nav__link">
    <span class="md-ellipsis">
      For Linux/macOS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-windows" class="md-nav__link">
    <span class="md-ellipsis">
      For Windows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alternate-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Alternate Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#message-broker-and-result-backend" class="md-nav__link">
    <span class="md-ellipsis">
      Message broker and Result backend
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celery-task-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      🌱 Celery Task Lifecycle
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🌱 Celery Task Lifecycle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-task-creation-producer-phase" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 1. Task Creation (Producer Phase)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-message-queuing-broker-phase" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 2. Message Queuing (Broker Phase)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-task-execution-worker-phase" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 3. Task Execution (Worker Phase)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-result-handling-optional" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 4. Result Handling (Optional)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-monitoring-retries" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 5. Monitoring &amp; Retries
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visual-summary" class="md-nav__link">
    <span class="md-ellipsis">
      🧠 Visual Summary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🧠 Visual Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-settings-in-celeryconfigpy" class="md-nav__link">
    <span class="md-ellipsis">
      ⚙️ Example Settings in celeryconfig.py
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-docker" class="md-nav__link">
    <span class="md-ellipsis">
      With Docker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sending-a-task-to-celery" class="md-nav__link">
    <span class="md-ellipsis">
      Sending a Task to Celery
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-celery-with-flower" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring Celery with Flower
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-redis" class="md-nav__link">
    <span class="md-ellipsis">
      Setting up Redis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#init-alembic" class="md-nav__link">
    <span class="md-ellipsis">
      Init Alembic
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Init Alembic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to-create-an-empty-dbsqlite3-run" class="md-nav__link">
    <span class="md-ellipsis">
      To create an empty db.sqlite3, run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migrate-the-database-even-though-we-dont-have-any-models-yet" class="md-nav__link">
    <span class="md-ellipsis">
      migrate the database even though we don't have any models yet
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Application Structure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Application Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Database Operations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-users-table" class="md-nav__link">
    <span class="md-ellipsis">
      Create users table
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-celery" class="md-nav__link">
    <span class="md-ellipsis">
      Add Celery
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Add Celery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notes_1" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks" class="md-nav__link">
    <span class="md-ellipsis">
      tasks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manual-test" class="md-nav__link">
    <span class="md-ellipsis">
      Manual Test
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dockerizing-celery-and-fastapi" class="md-nav__link">
    <span class="md-ellipsis">
      Dockerizing Celery and FastAPI
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Environment Variables
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../asynchronous_api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Async_api
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    tools
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/poetry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    poetry
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pydantic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pydantic
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../important/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    imp
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../revision/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    revision
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#celery-vs-fastapis-backgroundtasks" class="md-nav__link">
    <span class="md-ellipsis">
      ⚖️ Celery vs FastAPI’s BackgroundTasks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="⚖️ Celery vs FastAPI’s BackgroundTasks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-should-you-use-celery-instead-of-fastapis-built-in-backgroundtasks" class="md-nav__link">
    <span class="md-ellipsis">
      When should you use Celery instead of FastAPI's built-in BackgroundTasks?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="When should you use Celery instead of FastAPI&#39;s built-in BackgroundTasks?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-cpu-intensive-or-time-consuming-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      1. CPU-Intensive or Time-Consuming Tasks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-task-management-and-status-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      2. Task Management and Status Tracking
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-notes" class="md-nav__link">
    <span class="md-ellipsis">
      🧪 Example Notes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-a-task-queue" class="md-nav__link">
    <span class="md-ellipsis">
      🔄 What is a Task Queue?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redis-in-memory-data-store" class="md-nav__link">
    <span class="md-ellipsis">
      💾 Redis — In-Memory Data Store
    </span>
  </a>
  
    <nav class="md-nav" aria-label="💾 Redis — In-Memory Data Store">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-redis-use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      ✅ Common Redis Use Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      📦 Installation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📦 Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-celery" class="md-nav__link">
    <span class="md-ellipsis">
      Install Celery
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-redis-python-client" class="md-nav__link">
    <span class="md-ellipsis">
      Install Redis (Python client)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-docker-compose-snippet-for-redis" class="md-nav__link">
    <span class="md-ellipsis">
      Example Docker Compose snippet for Redis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#in-memory-database-vs-cache" class="md-nav__link">
    <span class="md-ellipsis">
      🧠 In-Memory Database vs. Cache
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-celery" class="md-nav__link">
    <span class="md-ellipsis">
      ▶️ Running Celery
    </span>
  </a>
  
    <nav class="md-nav" aria-label="▶️ Running Celery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-python-file-interactive-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Run Python File (Interactive Mode)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-celery-worker" class="md-nav__link">
    <span class="md-ellipsis">
      Start Celery Worker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Start Celery Worker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-linuxmacos" class="md-nav__link">
    <span class="md-ellipsis">
      For Linux/macOS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-windows" class="md-nav__link">
    <span class="md-ellipsis">
      For Windows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alternate-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Alternate Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#message-broker-and-result-backend" class="md-nav__link">
    <span class="md-ellipsis">
      Message broker and Result backend
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celery-task-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      🌱 Celery Task Lifecycle
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🌱 Celery Task Lifecycle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-task-creation-producer-phase" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 1. Task Creation (Producer Phase)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-message-queuing-broker-phase" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 2. Message Queuing (Broker Phase)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-task-execution-worker-phase" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 3. Task Execution (Worker Phase)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-result-handling-optional" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 4. Result Handling (Optional)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-monitoring-retries" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 5. Monitoring &amp; Retries
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visual-summary" class="md-nav__link">
    <span class="md-ellipsis">
      🧠 Visual Summary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🧠 Visual Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-settings-in-celeryconfigpy" class="md-nav__link">
    <span class="md-ellipsis">
      ⚙️ Example Settings in celeryconfig.py
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-docker" class="md-nav__link">
    <span class="md-ellipsis">
      With Docker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sending-a-task-to-celery" class="md-nav__link">
    <span class="md-ellipsis">
      Sending a Task to Celery
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-celery-with-flower" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring Celery with Flower
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-redis" class="md-nav__link">
    <span class="md-ellipsis">
      Setting up Redis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#init-alembic" class="md-nav__link">
    <span class="md-ellipsis">
      Init Alembic
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Init Alembic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to-create-an-empty-dbsqlite3-run" class="md-nav__link">
    <span class="md-ellipsis">
      To create an empty db.sqlite3, run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migrate-the-database-even-though-we-dont-have-any-models-yet" class="md-nav__link">
    <span class="md-ellipsis">
      migrate the database even though we don't have any models yet
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Application Structure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Application Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Database Operations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-users-table" class="md-nav__link">
    <span class="md-ellipsis">
      Create users table
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-celery" class="md-nav__link">
    <span class="md-ellipsis">
      Add Celery
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Add Celery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notes_1" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks" class="md-nav__link">
    <span class="md-ellipsis">
      tasks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manual-test" class="md-nav__link">
    <span class="md-ellipsis">
      Manual Test
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dockerizing-celery-and-fastapi" class="md-nav__link">
    <span class="md-ellipsis">
      Dockerizing Celery and FastAPI
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Environment Variables
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="celery-distributed-task-queue">⚙️ Celery - Distributed Task Queue<a class="headerlink" href="#celery-distributed-task-queue" title="Permanent link">&para;</a></h1>
<p><strong>Celery</strong> is a distributed task queue that focuses on real-time processing, while also supporting task scheduling.</p>
<blockquote>
<p>🐍 <strong>It is the most popular task queue in Python.</strong></p>
</blockquote>
<p>Celery allows you to return an HTTP response immediately and run long-running processes in the background, so users don't have to wait for the task to complete.</p>
<hr />
<h2 id="celery-vs-fastapis-backgroundtasks">⚖️ Celery vs FastAPI’s <code>BackgroundTasks</code><a class="headerlink" href="#celery-vs-fastapis-backgroundtasks" title="Permanent link">&para;</a></h2>
<h3 id="when-should-you-use-celery-instead-of-fastapis-built-in-backgroundtasks">When should you use <strong>Celery</strong> instead of FastAPI's built-in <code>BackgroundTasks</code>?<a class="headerlink" href="#when-should-you-use-celery-instead-of-fastapis-built-in-backgroundtasks" title="Permanent link">&para;</a></h3>
<h4 id="1-cpu-intensive-or-time-consuming-tasks">1. <strong>CPU-Intensive or Time-Consuming Tasks</strong><a class="headerlink" href="#1-cpu-intensive-or-time-consuming-tasks" title="Permanent link">&para;</a></h4>
<p>Use Celery when the task involves heavy computation, file processing, or long-running operations. FastAPI’s <code>BackgroundTasks</code> runs in the same event loop as your main app and is better suited for lightweight, non-blocking operations.</p>
<h4 id="2-task-management-and-status-tracking">2. <strong>Task Management and Status Tracking</strong><a class="headerlink" href="#2-task-management-and-status-tracking" title="Permanent link">&para;</a></h4>
<p>If you need to:</p>
<ul>
<li>Manage a <strong>queue</strong> of tasks</li>
<li><strong>Distribute</strong> tasks to multiple workers</li>
<li><strong>Track</strong> task status</li>
<li><strong>Retry</strong> failed tasks</li>
<li><strong>Schedule</strong> recurring tasks</li>
</ul>
<p>...then <strong>Celery</strong> is the right tool. It’s built for robust background task orchestration.</p>
<hr />
<h2 id="example-notes">🧪 Example Notes<a class="headerlink" href="#example-notes" title="Permanent link">&para;</a></h2>
<ol>
<li>After creating your FastAPI app, create a separate instance of Celery.</li>
<li>Configure the <strong>broker</strong> and <strong>backend</strong> (e.g., Redis).</li>
<li>Avoid hardcoding config values — use environment variables or a <code>.env</code> file.</li>
<li>Define your Celery tasks (e.g., a long-running task like <code>divide</code>).</li>
</ol>
<hr />
<h2 id="what-is-a-task-queue">🔄 What is a Task Queue?<a class="headerlink" href="#what-is-a-task-queue" title="Permanent link">&para;</a></h2>
<p>A <strong>task queue</strong> is a mechanism to offload:</p>
<ul>
<li><strong>Time-intensive</strong></li>
<li><strong>CPU- or memory-heavy</strong></li>
<li><strong>Unreliable or third-party dependent</strong></li>
</ul>
<p>...operations to a <strong>separate process</strong>, preventing the main application from being blocked.</p>
<blockquote>
<p>Think of it as a background worker system with its own job list.</p>
</blockquote>
<p>To use a task queue like Celery:</p>
<ul>
<li>You need a <strong>broker</strong> (message driver) such as Redis or RabbitMQ.</li>
<li>Celery connects to the broker and listens for tasks to process.</li>
</ul>
<p><img alt="Celery Architecture" src="../img/celery.png" /></p>
<hr />
<h2 id="redis-in-memory-data-store">💾 Redis — In-Memory Data Store<a class="headerlink" href="#redis-in-memory-data-store" title="Permanent link">&para;</a></h2>
<p><strong>Redis</strong> is a high-performance, in-memory key-value store, often used as:</p>
<ul>
<li>A <strong>message broker</strong> (Celery needs this)</li>
<li>A <strong>cache</strong></li>
<li>An <strong>in-memory database</strong></li>
</ul>
<hr />
<h3 id="common-redis-use-cases">✅ Common Redis Use Cases<a class="headerlink" href="#common-redis-use-cases" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Real-Time Analytics:</strong> e.g., fraud detection</li>
<li><strong>Session Storage:</strong> for fast web session retrieval</li>
<li><strong>Gaming Leaderboards:</strong> for fast sorting and updates in games</li>
</ul>
<hr />
<h2 id="installation">📦 Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h2>
<h3 id="install-celery">Install Celery<a class="headerlink" href="#install-celery" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>pip<span class="w"> </span>install<span class="w"> </span>celery
</code></pre></div>
<h3 id="install-redis-python-client">Install Redis (Python client)<a class="headerlink" href="#install-redis-python-client" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>pip<span class="w"> </span>install<span class="w"> </span>redis
</code></pre></div>
<blockquote>
<p>⚠️ You also need an actual Redis server running. You can use <strong>Docker</strong> or <strong>Docker Compose</strong> for that.</p>
</blockquote>
<h3 id="example-docker-compose-snippet-for-redis">Example Docker Compose snippet for Redis<a class="headerlink" href="#example-docker-compose-snippet-for-redis" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">  </span><span class="nt">redis</span><span class="p">:</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:latest</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;6379:6379&quot;</span>
</code></pre></div>
<hr />
<h2 id="in-memory-database-vs-cache">🧠 In-Memory Database vs. Cache<a class="headerlink" href="#in-memory-database-vs-cache" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Feature</th>
<th>In-Memory Database</th>
<th>Cache</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Purpose</strong></td>
<td>Primary data store</td>
<td>Temporary, fast-access storage</td>
</tr>
<tr>
<td><strong>Persistence</strong></td>
<td>Persistent (optional)</td>
<td>Usually non-persistent</td>
</tr>
<tr>
<td><strong>Use Case</strong></td>
<td>Session storage, analytics</td>
<td>Speed up frequent reads</td>
</tr>
<tr>
<td><strong>Durability</strong></td>
<td>Higher</td>
<td>Volatile</td>
</tr>
<tr>
<td><strong>Scalability</strong></td>
<td>High</td>
<td>Limited by memory</td>
</tr>
</tbody>
</table>
<p><strong>Summary:</strong></p>
<ul>
<li>Use a <strong>cache</strong> to optimize <strong>read performance</strong>.</li>
<li>Use an <strong>in-memory DB</strong> to <strong>store and process live data</strong> quickly.</li>
</ul>
<hr />
<h2 id="running-celery">▶️ Running Celery<a class="headerlink" href="#running-celery" title="Permanent link">&para;</a></h2>
<h3 id="run-python-file-interactive-mode">Run Python File (Interactive Mode)<a class="headerlink" href="#run-python-file-interactive-mode" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>python<span class="w"> </span>-i<span class="w"> </span>task.py
</code></pre></div>
<h3 id="start-celery-worker">Start Celery Worker<a class="headerlink" href="#start-celery-worker" title="Permanent link">&para;</a></h3>
<h4 id="for-linuxmacos">For Linux/macOS<a class="headerlink" href="#for-linuxmacos" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>celery<span class="w"> </span>-A<span class="w"> </span>task<span class="w"> </span>worker<span class="w"> </span>-l<span class="w"> </span>info
</code></pre></div>
<h4 id="for-windows">For Windows<a class="headerlink" href="#for-windows" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>celery<span class="w"> </span>-A<span class="w"> </span>task<span class="w"> </span>worker<span class="w"> </span>--pool<span class="o">=</span>solo<span class="w"> </span>-l<span class="w"> </span>info
</code></pre></div>
<h4 id="alternate-examples">Alternate Examples<a class="headerlink" href="#alternate-examples" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>celery<span class="w"> </span>-A<span class="w"> </span>app.celery_worker.celery<span class="w"> </span>worker<span class="w"> </span>--loglevel<span class="o">=</span>info
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>celery<span class="w"> </span>-A<span class="w"> </span>main.celery<span class="w"> </span>worker<span class="w"> </span>--loglevel<span class="o">=</span>info
</code></pre></div>
<hr />
<p><img alt="alt text" src="../img/celery.png" /></p>
<h2 id="message-broker-and-result-backend">Message broker and Result backend<a class="headerlink" href="#message-broker-and-result-backend" title="Permanent link">&para;</a></h2>
<ul>
<li>Message broker is an intermediary program used as the transport for producing or consuming tasks.</li>
<li>Result backend is used to store the result of a Celery task.</li>
</ul>
<blockquote>
<p>The Celery client is the producer which adds a new task to the queue via the message broker. Celery workers then consume new tasks from the queue, again, via the message broker. Once processed, results are then stored in the result backend.</p>
</blockquote>
<p>In terms of tools, RabbitMQ is arguably the better choice for a message broker since it supports AMQP (Advanced Message Queuing Protocol) while Redis is fine as your result backend.</p>
<p>step-by-step format:</p>
<hr />
<h2 id="celery-task-lifecycle">🌱 <strong>Celery Task Lifecycle</strong><a class="headerlink" href="#celery-task-lifecycle" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>[Your App] --&gt; [Broker (Redis/RabbitMQ)] --&gt; [Celery Worker] --&gt; [Result Backend (Optional)]
</code></pre></div>
<hr />
<h3 id="1-task-creation-producer-phase">🔹 1. <strong>Task Creation (Producer Phase)</strong><a class="headerlink" href="#1-task-creation-producer-phase" title="Permanent link">&para;</a></h3>
<ul>
<li>You (the developer) call a Celery task using <code>.delay()</code> or <code>.apply_async()</code>.</li>
<li>This sends the <strong>task request</strong> to the <strong>message broker</strong>.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">my_task</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span>
</code></pre></div>
<hr />
<h3 id="2-message-queuing-broker-phase">🔹 2. <strong>Message Queuing (Broker Phase)</strong><a class="headerlink" href="#2-message-queuing-broker-phase" title="Permanent link">&para;</a></h3>
<ul>
<li>Celery <strong>serializes</strong> the task and <strong>pushes</strong> it into the <strong>message queue</strong> (e.g., Redis, RabbitMQ).</li>
<li>The broker <strong>queues</strong> tasks until workers are available.</li>
</ul>
<hr />
<h3 id="3-task-execution-worker-phase">🔹 3. <strong>Task Execution (Worker Phase)</strong><a class="headerlink" href="#3-task-execution-worker-phase" title="Permanent link">&para;</a></h3>
<ul>
<li>Celery <strong>workers</strong> continuously listen for new tasks from the broker.</li>
<li>
<p>When a task is available:</p>
</li>
<li>
<p>The worker <strong>picks it up</strong>, <strong>deserializes</strong> it, and <strong>executes</strong> the Python function you defined.</p>
</li>
</ul>
<hr />
<h3 id="4-result-handling-optional">🔹 4. <strong>Result Handling (Optional)</strong><a class="headerlink" href="#4-result-handling-optional" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>If you’ve configured a <strong>result backend</strong> (e.g., Redis, database, S3):</p>
</li>
<li>
<p>The worker <strong>stores the result</strong> of the task there.</p>
</li>
<li>You can later <strong>fetch the result</strong> using <code>.get()</code> on the task's AsyncResult.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">result</span> <span class="o">=</span> <span class="n">my_task</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>  <span class="c1"># waits for the task to finish and returns result</span>
</code></pre></div>
<hr />
<h3 id="5-monitoring-retries">🔹 5. <strong>Monitoring &amp; Retries</strong><a class="headerlink" href="#5-monitoring-retries" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Celery supports:</p>
</li>
<li>
<p><strong>Retries</strong> (for failed tasks)</p>
</li>
<li><strong>Error handling</strong></li>
<li><strong>Timeouts</strong></li>
<li><strong>Task expiration</strong></li>
<li>You can monitor task status using tools like <strong>Flower</strong>, Prometheus exporters, etc.</li>
</ul>
<hr />
<h2 id="visual-summary">🧠 Visual Summary<a class="headerlink" href="#visual-summary" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>App --&gt; Broker --&gt; Worker --&gt; Result Backend
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a> ↑                             ↓
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a> Retry / Timeout        Result status (SUCCESS / FAILURE)
</code></pre></div>
<hr />
<h3 id="example-settings-in-celeryconfigpy">⚙️ Example Settings in <code>celeryconfig.py</code><a class="headerlink" href="#example-settings-in-celeryconfigpy" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">broker_url</span> <span class="o">=</span> <span class="s1">&#39;redis://localhost:6379/0&#39;</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="n">result_backend</span> <span class="o">=</span> <span class="s1">&#39;redis://localhost:6379/1&#39;</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="n">task_serializer</span> <span class="o">=</span> <span class="s1">&#39;json&#39;</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="n">result_serializer</span> <span class="o">=</span> <span class="s1">&#39;json&#39;</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="n">accept_content</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">]</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="n">timezone</span> <span class="o">=</span> <span class="s1">&#39;UTC&#39;</span>
</code></pre></div>
<hr />
<p><img alt="artitacture" src="../img/0_DHowAiR1dMhpyqWi.webp" /></p>
<p><img alt="life cycle" src="../img/ChatGPT%20Image%20Jun%209%2C%202025%2C%2001_09_47%20PM.png" /></p>
<p><img alt="alt text" src="../img/setup_celery_fastapi.png" /></p>
<ol>
<li>The Celery client (the producer) adds a new task to the queue via the message broker.</li>
<li>The Celery worker (the consumer) grabs the tasks from the queue, again, via the message broker.</li>
<li>Once processed, results are stored in the result backend.</li>
</ol>
<h3 id="with-docker">With Docker<a class="headerlink" href="#with-docker" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>docker<span class="w"> </span>run<span class="w"> </span>-p<span class="w"> </span><span class="m">6379</span>:6379<span class="w"> </span>--name<span class="w"> </span>some-redis<span class="w"> </span>-d<span class="w"> </span>redis
</code></pre></div>
<p>This downloads the official Redis Docker image from Docker Hub and runs it on port 6379 in the background.</p>
<p>To test if Redis is up and running, run:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>some-redis<span class="w"> </span>redis-cli<span class="w"> </span>ping
</code></pre></div>
<h3 id="sending-a-task-to-celery">Sending a Task to Celery<a class="headerlink" href="#sending-a-task-to-celery" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>celery<span class="w"> </span>-A<span class="w"> </span>main.celery<span class="w"> </span>worker<span class="w"> </span>--loglevel<span class="o">=</span>info
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">main</span><span class="w"> </span><span class="kn">import</span> <span class="n">app</span><span class="p">,</span> <span class="n">divide</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">task</span> <span class="o">=</span> <span class="n">divide</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div>
<p>What's happening?</p>
<ol>
<li>We used the delay method to send a new message to the message broker. The worker process then picked up and executed the task from the queue.</li>
<li>After releasing from the Enter key, the code finished executing while the divide task ran in the background.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nv">task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>divide.delay<span class="o">(</span><span class="m">1</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>task.state
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>task.result
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">celery.result</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncResult</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="n">task</span> <span class="o">=</span> <span class="n">AsyncResult</span><span class="p">(</span><span class="s1">&#39;8e3da1cc-a6aa-42ba-ab72-6ca7544d3730&#39;</span><span class="p">)</span>  <span class="c1"># replace with your UUID</span>
</code></pre></div>
<p>After we called the delay method, we get an AsyncResult instance, which can be used to check the task state along with the return value or exception details</p>
<h2 id="monitoring-celery-with-flower">Monitoring Celery with Flower<a class="headerlink" href="#monitoring-celery-with-flower" title="Permanent link">&para;</a></h2>
<p>Flower is a real-time web application monitoring and administration tool for Celery.</p>
<p>Familiarize yourself a bit with the Flower dashboard.
Take note of the UUID column. This is the id of AsyncResult</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>celery<span class="w"> </span>-A<span class="w"> </span>main.celery<span class="w"> </span>flower<span class="w"> </span>--port<span class="o">=</span><span class="m">5555</span>
</code></pre></div>
<p>print <code>task.state</code> and <code>task.result</code></p>
<h2 id="setting-up-redis">Setting up Redis<a class="headerlink" href="#setting-up-redis" title="Permanent link">&para;</a></h2>
<p>You can set up and run Redis directly from your operating system or from a Docker container.</p>
<p>o/p
PONG</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">celery.result</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncResult</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="n">task</span> <span class="o">=</span> <span class="n">AsyncResult</span><span class="p">(</span><span class="s1">&#39;8e3da1cc-a6aa-42ba-ab72-6ca7544d3730&#39;</span><span class="p">)</span>  <span class="c1"># replace with your UUID</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="n">task</span><span class="o">.</span><span class="n">state</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="c1"># &#39;FAILURE&#39;</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="n">task</span><span class="o">.</span><span class="n">result</span>
</code></pre></div>
<p><img alt="alt text" src="../img/flower.PNG" /></p>
<ul>
<li>
<p>Celery doesn't support asyncio very well (since it was developed before asyncio), we're using SQLAlchemy as our ORM because it can be used with both FastAPI and Celery.</p>
</li>
<li>
<p>Alembic is a database migration tool for SQLAlchemy.</p>
</li>
</ul>
<p>config.py</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">lru_cache</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">BaseConfig</span><span class="p">:</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>    <span class="n">BASE_DIR</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>    <span class="n">DATABASE_URL</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sqlite:///</span><span class="si">{</span><span class="n">BASE_DIR</span><span class="si">}</span><span class="s2">/db.sqlite3&quot;</span><span class="p">)</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>    <span class="n">DATABASE_CONNECT_DICT</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">DevelopmentConfig</span><span class="p">(</span><span class="n">BaseConfig</span><span class="p">):</span>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>    <span class="k">pass</span>
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="k">class</span><span class="w"> </span><span class="nc">ProductionConfig</span><span class="p">(</span><span class="n">BaseConfig</span><span class="p">):</span>
<a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>    <span class="k">pass</span>
<a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a>
<a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a>
<a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="k">class</span><span class="w"> </span><span class="nc">TestingConfig</span><span class="p">(</span><span class="n">BaseConfig</span><span class="p">):</span>
<a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a>    <span class="k">pass</span>
<a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a>
<a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a>
<a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a><span class="nd">@lru_cache</span><span class="p">()</span>
<a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_settings</span><span class="p">():</span>
<a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a>    <span class="n">config_cls_dict</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a>        <span class="s2">&quot;development&quot;</span><span class="p">:</span> <span class="n">DevelopmentConfig</span><span class="p">,</span>
<a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a>        <span class="s2">&quot;production&quot;</span><span class="p">:</span> <span class="n">ProductionConfig</span><span class="p">,</span>
<a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a>        <span class="s2">&quot;testing&quot;</span><span class="p">:</span> <span class="n">TestingConfig</span>
<a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a>    <span class="p">}</span>
<a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a>
<a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a>    <span class="n">config_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;FASTAPI_CONFIG&quot;</span><span class="p">,</span> <span class="s2">&quot;development&quot;</span><span class="p">)</span>
<a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a>    <span class="n">config_cls</span> <span class="o">=</span> <span class="n">config_cls_dict</span><span class="p">[</span><span class="n">config_name</span><span class="p">]</span>
<a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a>    <span class="k">return</span> <span class="n">config_cls</span><span class="p">()</span>
<a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a>
<a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a>
<a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a><span class="n">settings</span> <span class="o">=</span> <span class="n">get_settings</span><span class="p">()</span>
</code></pre></div>
<ul>
<li>In get_settings, we used the FASTAPI_CONFIG env variable to control which configuration to use. For example, during development, DevelopmentConfig will be used and TestingConfig will be used during test.</li>
<li>I do not recommend pydantic BaseSettings here because it might cause Celery to raise [ERROR/MainProcess] pidbox command error: KeyError('<strong>signature</strong>') error when we launch Flower</li>
</ul>
<h2 id="init-alembic">Init Alembic<a class="headerlink" href="#init-alembic" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>alembic init alembic
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">config</span><span class="o">.</span><span class="n">set_main_option</span><span class="p">(</span><span class="s2">&quot;sqlalchemy.url&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">DATABASE_URL</span><span class="p">))</span>        <span class="c1"># new</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="n">fastapi_app</span> <span class="o">=</span> <span class="n">create_app</span><span class="p">()</span>    <span class="c1"># new</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="n">target_metadata</span> <span class="o">=</span> <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span>       <span class="c1"># new</span>
</code></pre></div>
<h3 id="notes">Notes<a class="headerlink" href="#notes" title="Permanent link">&para;</a></h3>
<ol>
<li>We used <code>config.set_main_option("sqlalchemy.url", str(settings.DATABASE_URL))</code> to set the database connection string.</li>
<li>Then, we used <code>create_app</code> to create a new <code>fastapi_app</code> instance to ensure the relevant models are loaded.</li>
<li>Finally, we added <code>target_metadata = Base.metadata</code> so that new models are discovered by Alembic.</li>
</ol>
<h3 id="to-create-an-empty-dbsqlite3-run">To create an empty db.sqlite3, run<a class="headerlink" href="#to-create-an-empty-dbsqlite3-run" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>python
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>from<span class="w"> </span>main<span class="w"> </span>import<span class="w"> </span>app
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>from<span class="w"> </span>app.database<span class="w"> </span>import<span class="w"> </span>Base,<span class="w"> </span>engine
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>Base.metadata.create_all<span class="o">(</span><span class="nv">bind</span><span class="o">=</span>engine<span class="o">)</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>exit<span class="o">()</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="o">(</span>venv<span class="o">)</span>ls<span class="w"> </span>db.sqlite3
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>db.sqlite3
</code></pre></div>
<h3 id="migrate-the-database-even-though-we-dont-have-any-models-yet">migrate the database even though we don't have any models yet<a class="headerlink" href="#migrate-the-database-even-though-we-dont-have-any-models-yet" title="Permanent link">&para;</a></h3>
<p><code>alembic revision --autogenerate</code></p>
<h2 id="application-structure">Application Structure<a class="headerlink" href="#application-structure" title="Permanent link">&para;</a></h2>
<p>If you have experience with Django or Flask, you've probably used "Django Apps" or "Flask Blueprints" to break up larger applications by grouping common functionality into reusable components.</p>
<p>Next, we'll do the same thing for FastAPI.</p>
<p>we can use somthing like</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fastapi</span><span class="w"> </span><span class="kn">import</span> <span class="n">APIRouter</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="n">users_router</span> <span class="o">=</span> <span class="n">APIRouter</span><span class="p">(</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>    <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;/users&quot;</span><span class="p">,</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="p">)</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span> <span class="c1"># noqa</span>
</code></pre></div>
<h3 id="database-operations">Database Operations<a class="headerlink" href="#database-operations" title="Permanent link">&para;</a></h3>
<p>alembic revision --autogenerate</p>
<h4 id="create-users-table">Create users table<a class="headerlink" href="#create-users-table" title="Permanent link">&para;</a></h4>
<p>alembic upgrade head</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>from<span class="w"> </span>main<span class="w"> </span>import<span class="w"> </span>app
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>from<span class="w"> </span>app.database<span class="w"> </span>import<span class="w"> </span>SessionLocal
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>from<span class="w"> </span>app.users.models<span class="w"> </span>import<span class="w"> </span>User
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="nv">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>User<span class="o">(</span><span class="nv">username</span><span class="o">=</span><span class="s1">&#39;test1&#39;</span>,<span class="w"> </span><span class="nv">user_email</span><span class="o">=</span><span class="s1">&#39;test1@example.com&#39;</span>,<span class="w"> </span><span class="nv">user_password</span><span class="o">=</span><span class="s1">&#39;test1&#39;</span><span class="o">)</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="nv">session</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>SessionLocal<span class="o">()</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>session.add<span class="o">(</span>user<span class="o">)</span>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>session.commit<span class="o">()</span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="nv">new_session</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>SessionLocal<span class="o">()</span>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>new_session.query<span class="o">(</span>User<span class="o">)</span>.first<span class="o">()</span>.username
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="s1">&#39;test1&#39;</span>
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>exit<span class="o">()</span>
</code></pre></div>
<h2 id="add-celery">Add Celery<a class="headerlink" href="#add-celery" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">celery</span><span class="w"> </span><span class="kn">import</span> <span class="n">current_app</span> <span class="k">as</span> <span class="n">current_celery_app</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">project.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">settings</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_celery</span><span class="p">():</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>    <span class="n">celery_app</span> <span class="o">=</span> <span class="n">current_celery_app</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>    <span class="n">celery_app</span><span class="o">.</span><span class="n">config_from_object</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s2">&quot;CELERY&quot;</span><span class="p">)</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>    <span class="k">return</span> <span class="n">celery_app</span>
</code></pre></div>
<h3 id="notes_1">Notes<a class="headerlink" href="#notes_1" title="Permanent link">&para;</a></h3>
<ol>
<li><code>create_celery</code> is a factory function that configures and then returns a Celery app instance.</li>
<li>Rather than creating a new Celery instance, we used current_app so that shared tasks will work as expected.</li>
<li><code>celery_app.config_from_object(settings, namespace="CELERY")</code> means all celery-related configuration keys should be prefixed with <code>CELERY_</code>. For example, to configure the <code>broker_url</code>, we should use <code>CELERY_BROKER_URL</code></li>
</ol>
<h3 id="tasks">tasks<a class="headerlink" href="#tasks" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">celery</span><span class="w"> </span><span class="kn">import</span> <span class="n">shared_task</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="nd">@shared_task</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">divide</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>    <span class="k">return</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span>
</code></pre></div>
<p><strong>Notes:</strong></p>
<ol>
<li>Many resources on the web recommend using <code>celery.task</code>. This might cause circular imports since you'll have to import the Celery instance.</li>
<li>We used <code>shared_task</code> to make our code reusable, which, again, requires current_app in <code>create_celery</code> instead of creating a new Celery instance.Now, we can copy this file anywhere in the app and it will work as expected.</li>
</ol>
<p>Celery tasks will be found when we launch the worker.</p>
<h2 id="manual-test">Manual Test<a class="headerlink" href="#manual-test" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>celery -A main.celery worker --loglevel=info
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>celery -A main.celery worker --pool=solo -l info 
</code></pre></div>
<p>[tasks]
  . app.users.tasks.divide</p>
<p>Note: From the tasks section above, we can see project.users.tasks.divide, which means that the Celery worker found the task successfully.</p>
<h2 id="dockerizing-celery-and-fastapi">Dockerizing Celery and FastAPI<a class="headerlink" href="#dockerizing-celery-and-fastapi" title="Permanent link">&para;</a></h2>
<p>Docker Compose</p>
<p>Docker Compose is a tool used for defining and running multi-container Docker applications. It uses YAML files to configure the application's services and performs the creation and start-up processes for all of the containers with a single command.</p>
<p>We've already looked at how to serve up an instance of Redis with Docker using a single command:</p>
<p>$ docker run -p 6379:6379 --name some-redis -d redis</p>
<p>Well, in this chapter, we'll take this a step further and containerize our entire infrastructure to simplify development. Before we do that though, let's look at the why: Why should we serve up our development environment in Docker containers with Docker Compose?</p>
<div class="highlight"><pre><span></span><code>Instead of having to run each process (e.g., Uvicorn/FastAPI, Celery worker, Celery beat, Flower, Redis, Postgres, etc.) manually, each from a different terminal window, after we containerize each service, Docker Compose enables us to manage and run the containers using a single command.
Docker Compose will also simplify configuration. The Celery config is currently tied to our FastAPI app&#39;s config. This is not ideal. With Docker Compose, we can easily create different configurations for both FastAPI and Celery all from a single YAML file.
Docker, in general, allows us to create isolated, reproducible, and portable development environments. So, you won&#39;t have to mess around with a virtual environment or install tools like Postgres and Redis on your local OS.
</code></pre></div>
<p>The "compose" folder holds configuration files, shell scripts, and the associated Dockerfiles for each environment.</p>
<p><img alt="alt text" src="../img/docker_compose_dev.png" /></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">    </span><span class="nt">build</span><span class="p">:</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">      </span><span class="nt">dockerfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./compose/local/fastapi/Dockerfile</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fastapi_celery_example_web</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">    </span><span class="c1"># &#39;/start&#39; is the shell script used to run the service</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/start</span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="w">    </span><span class="c1"># this volume is used to map the files and folders on the host to the container</span>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="w">    </span><span class="c1"># so if we change code on the host, code in the docker container will also be changed</span>
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.:/app</span>
<a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8010:8000</span>
<a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="w">    </span><span class="nt">env_file</span><span class="p">:</span>
<a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env/.dev-sample</span>
<a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis</span>
<a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
<a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a>
<a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
<a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:16-alpine</span>
<a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres_data:/var/lib/postgresql/data/</span>
<a id="__codelineno-29-25" name="__codelineno-29-25" href="#__codelineno-29-25"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<a id="__codelineno-29-26" name="__codelineno-29-26" href="#__codelineno-29-26"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRES_DB=fastapi_celery</span>
<a id="__codelineno-29-27" name="__codelineno-29-27" href="#__codelineno-29-27"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRES_USER=fastapi_celery</span>
<a id="__codelineno-29-28" name="__codelineno-29-28" href="#__codelineno-29-28"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRES_PASSWORD=fastapi_celery</span>
<a id="__codelineno-29-29" name="__codelineno-29-29" href="#__codelineno-29-29"></a>
<a id="__codelineno-29-30" name="__codelineno-29-30" href="#__codelineno-29-30"></a><span class="w">  </span><span class="nt">redis</span><span class="p">:</span>
<a id="__codelineno-29-31" name="__codelineno-29-31" href="#__codelineno-29-31"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
<a id="__codelineno-29-32" name="__codelineno-29-32" href="#__codelineno-29-32"></a>
<a id="__codelineno-29-33" name="__codelineno-29-33" href="#__codelineno-29-33"></a><span class="w">  </span><span class="nt">celery_worker</span><span class="p">:</span>
<a id="__codelineno-29-34" name="__codelineno-29-34" href="#__codelineno-29-34"></a><span class="w">    </span><span class="nt">build</span><span class="p">:</span>
<a id="__codelineno-29-35" name="__codelineno-29-35" href="#__codelineno-29-35"></a><span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
<a id="__codelineno-29-36" name="__codelineno-29-36" href="#__codelineno-29-36"></a><span class="w">      </span><span class="nt">dockerfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./compose/local/fastapi/Dockerfile</span>
<a id="__codelineno-29-37" name="__codelineno-29-37" href="#__codelineno-29-37"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fastapi_celery_example_celery_worker</span>
<a id="__codelineno-29-38" name="__codelineno-29-38" href="#__codelineno-29-38"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/start-celeryworker</span>
<a id="__codelineno-29-39" name="__codelineno-29-39" href="#__codelineno-29-39"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-29-40" name="__codelineno-29-40" href="#__codelineno-29-40"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.:/app</span>
<a id="__codelineno-29-41" name="__codelineno-29-41" href="#__codelineno-29-41"></a><span class="w">    </span><span class="nt">env_file</span><span class="p">:</span>
<a id="__codelineno-29-42" name="__codelineno-29-42" href="#__codelineno-29-42"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env/.dev-sample</span>
<a id="__codelineno-29-43" name="__codelineno-29-43" href="#__codelineno-29-43"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<a id="__codelineno-29-44" name="__codelineno-29-44" href="#__codelineno-29-44"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis</span>
<a id="__codelineno-29-45" name="__codelineno-29-45" href="#__codelineno-29-45"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
<a id="__codelineno-29-46" name="__codelineno-29-46" href="#__codelineno-29-46"></a>
<a id="__codelineno-29-47" name="__codelineno-29-47" href="#__codelineno-29-47"></a><span class="w">  </span><span class="nt">celery_beat</span><span class="p">:</span>
<a id="__codelineno-29-48" name="__codelineno-29-48" href="#__codelineno-29-48"></a><span class="w">    </span><span class="nt">build</span><span class="p">:</span>
<a id="__codelineno-29-49" name="__codelineno-29-49" href="#__codelineno-29-49"></a><span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
<a id="__codelineno-29-50" name="__codelineno-29-50" href="#__codelineno-29-50"></a><span class="w">      </span><span class="nt">dockerfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./compose/local/fastapi/Dockerfile</span>
<a id="__codelineno-29-51" name="__codelineno-29-51" href="#__codelineno-29-51"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fastapi_celery_example_celery_beat</span>
<a id="__codelineno-29-52" name="__codelineno-29-52" href="#__codelineno-29-52"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/start-celerybeat</span>
<a id="__codelineno-29-53" name="__codelineno-29-53" href="#__codelineno-29-53"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-29-54" name="__codelineno-29-54" href="#__codelineno-29-54"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.:/app</span>
<a id="__codelineno-29-55" name="__codelineno-29-55" href="#__codelineno-29-55"></a><span class="w">    </span><span class="nt">env_file</span><span class="p">:</span>
<a id="__codelineno-29-56" name="__codelineno-29-56" href="#__codelineno-29-56"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env/.dev-sample</span>
<a id="__codelineno-29-57" name="__codelineno-29-57" href="#__codelineno-29-57"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<a id="__codelineno-29-58" name="__codelineno-29-58" href="#__codelineno-29-58"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis</span>
<a id="__codelineno-29-59" name="__codelineno-29-59" href="#__codelineno-29-59"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
<a id="__codelineno-29-60" name="__codelineno-29-60" href="#__codelineno-29-60"></a>
<a id="__codelineno-29-61" name="__codelineno-29-61" href="#__codelineno-29-61"></a><span class="w">  </span><span class="nt">flower</span><span class="p">:</span>
<a id="__codelineno-29-62" name="__codelineno-29-62" href="#__codelineno-29-62"></a><span class="w">    </span><span class="nt">build</span><span class="p">:</span>
<a id="__codelineno-29-63" name="__codelineno-29-63" href="#__codelineno-29-63"></a><span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
<a id="__codelineno-29-64" name="__codelineno-29-64" href="#__codelineno-29-64"></a><span class="w">      </span><span class="nt">dockerfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./compose/local/fastapi/Dockerfile</span>
<a id="__codelineno-29-65" name="__codelineno-29-65" href="#__codelineno-29-65"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fastapi_celery_example_celery_flower</span>
<a id="__codelineno-29-66" name="__codelineno-29-66" href="#__codelineno-29-66"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/start-flower</span>
<a id="__codelineno-29-67" name="__codelineno-29-67" href="#__codelineno-29-67"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-29-68" name="__codelineno-29-68" href="#__codelineno-29-68"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.:/app</span>
<a id="__codelineno-29-69" name="__codelineno-29-69" href="#__codelineno-29-69"></a><span class="w">    </span><span class="nt">env_file</span><span class="p">:</span>
<a id="__codelineno-29-70" name="__codelineno-29-70" href="#__codelineno-29-70"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env/.dev-sample</span>
<a id="__codelineno-29-71" name="__codelineno-29-71" href="#__codelineno-29-71"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-29-72" name="__codelineno-29-72" href="#__codelineno-29-72"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5557:5555</span>
<a id="__codelineno-29-73" name="__codelineno-29-73" href="#__codelineno-29-73"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<a id="__codelineno-29-74" name="__codelineno-29-74" href="#__codelineno-29-74"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis</span>
<a id="__codelineno-29-75" name="__codelineno-29-75" href="#__codelineno-29-75"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
<a id="__codelineno-29-76" name="__codelineno-29-76" href="#__codelineno-29-76"></a>
<a id="__codelineno-29-77" name="__codelineno-29-77" href="#__codelineno-29-77"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-29-78" name="__codelineno-29-78" href="#__codelineno-29-78"></a><span class="w">  </span><span class="nt">postgres_data</span><span class="p">:</span>
</code></pre></div>
<p>we defined six services:</p>
<ol>
<li>web is the FastAPI server</li>
<li>db is the Postgres server</li>
<li>redis is the Redis service, which will be used as the Celery message broker and result backend</li>
<li>celery_worker is the Celery worker process</li>
<li>celery_beat is the Celery beat process for scheduled tasks</li>
<li>flower is the Celery dashboard</li>
</ol>
<p>Review the web, db, and redis services on your own, taking note of the comments. To simplify things, the web, celery_worker, celery_beat, and flower services will all use the same Dockerfile.</p>
<h2 id="environment-variables">Environment Variables<a class="headerlink" href="#environment-variables" title="Permanent link">&para;</a></h2>
<p>Create a new folder to store environment variables in the project root called .env. Then, add a new file to that folder called .dev-sample:</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2024 <a href="https://github.com/ashishbindra2"  target="_blank" rel="noopener">Ashish Bindra</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/ashishbindra2" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://in.linkedin.com/in/ashishbindra2/" target="_blank" rel="noopener" title="in.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.tabs.link", "content.code.annotation", "content.code.copy", "navigation.sections", "navigation.indexes", "navigation.instant", "navigation.tabs", "navigation.top", "navigation.tracking", "search.suggest", "search.highlight", "toc.follow"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>